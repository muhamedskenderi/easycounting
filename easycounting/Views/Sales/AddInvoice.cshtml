@model easycounting.Models.Invoice

@{
    ViewBag.Title = "New Invoice";
    Layout = "~/Views/Shared/Menu.cshtml";

}
<link href="~/assets/css/aka.css" rel="stylesheet" />






<div class="page-header">
    <div class="row">
        <div class="col-sm-12">
            <h3 class="page-title">Sales</h3>
            <ul class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="@Url.Action("","home")">Dashboard</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="@Url.Action("","Sales")">Sales</a>
                </li>
                <li class="breadcrumb-item active">Add Invoice</li>
            </ul>
        </div>
    </div>
</div>


<div class="row">
    <div class="col-md-12">
        <div class="card">
            @using (Html.BeginForm())
            {

                @Html.AntiForgeryToken()
                @Html.HiddenFor(x => x.ItemsCount, new { id = "itemCounter", name = "itemCounter" })
                @Html.HiddenFor(x => x.total, new { id = "totalAmount", name = "totalAmount" })


                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                            <div class="row">
                                <div id="select-contact-card-6" class="document-add-body-form-contact ml-3">
                                    <div class="document-contact">
                                        <div class="document-contact-without-contact">
                                            <div class="document-contact-without-contact-box-contact-select fs-exclude">
                                                <div tabindex="0" class="aka-select aka-select--medium is-open" id="addCustomer">
                                                    <div>
                                                        <div class="aka-box aka-box--large">
                                                            <div class="aka-box-content">
                                                                <div class="document-contact-without-contact-box">
                                                                    <button type="button" data-toggle="modal" data-target="#add_customer" class="btn-aka-link aka-btn--fluid document-contact-without-contact-box-btn">
                                                                        <i class="far fa-user fa-2x"></i> &nbsp; Add a Customer
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!---->
                                                    </div>
                                                    <!---->
                                                </div>


                                                <div id="customerDetails" class="document-add-body-form-contact ml-3">
                                                    <div class="document-contact fs-exclude">
                                                        <div class="document-contact-without-contact">
                                                            <div class="document-contact-with-contact-bill-to">
                                                                <div><span class="aka-text aka-text--block-label">Invoice From</span></div> <div class="table-responsive">
                                                                    <table class="table table-borderless p-0">
                                                                        <tbody>
                                                                            <tr><th class="p-0" id="customerName"><strong class="d-block">Uniqa AD</strong></th></tr>
                                                                            <tr>
                                                                                <th class="p-0" id="customerAddress">

                                                                                </th>
                                                                            </tr>
                                                                            <tr>
                                                                                <th class="p-0" id="customerTaxNo">

                                                                                </th>
                                                                            </tr>
                                                                            <tr>
                                                                                <th class="p-0" id="customerPhone">

                                                                                </th>
                                                                            </tr>
                                                                            <tr>
                                                                                <th class="p-0" id="customerEmail">
                                                                                </th>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                                <button data-toggle="modal" data-target="#add_customer" type="button" class="btn btn-link p-0">
                                                                    Choose a different customer
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                            <div class="row">
                                <div class="form-group col-md-6 required">
                                    <label for="document_number" class="form-control-label">Status </label>
                                    <div class="input-group input-group-merge ">
                                        <div class="input-group-prepend"><span class="input-group-text"><i class="far fa-list-alt"></i></span></div>
                                        <select name="invoiceStatus" class="form-control" id="invoiceStatus">
                                            <option class="bg-warning-light" value="Unpaid">Unpaid</option>
                                            <option class="bg-success-light" value="Paid">Paid</option>
                                            <option value="Overdue" class="bg-danger-light">Overdue</option>

                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-md-6 required">
                                    <label for="document_number" class="form-control-label">Sale Category <a data-toggle="modal" data-target="#add_sale" class="btn-sm btn-outline-primary"><i class="fa fa-plus-square"></i></a></label>
                                    <div class="input-group input-group-merge ">
                                        <div class="input-group-prepend"><span class="input-group-text"><i class="far fa-list-alt"></i></span></div>
                                        @Html.DropDownList("saleID", ViewBag.sales as SelectList, new { @class = "form-control ", @style = "" })
                                    </div>
                                </div>
                                <div class="form-group col-md-4 required" group_class="" required="required">
                                    <label class="form-control-label">
                                        Invoice No
                                    </label>

                                    <div class="input-group input-group-merge ">
                                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-file"></i></span></div>
                                        <input type="text" class="form-control" name="invoiceNo" id="invoiceNo" />
                                    </div>
                                </div>
                                <div class="form-group col-md-4 required" group_class="" required="required">
                                    <label class="form-control-label">
                                        Invoice Date
                                    </label>
                                    <div class="input-group input-group-merge has-label">
                                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-calendar"></i></span></div>
                                        <input type="date" name="invoiceDate" id="invoiceDate" class="form-control" required />
                                    </div>
                                </div>
                                <div class="form-group col-md-4 required" group_class="" required="required">
                                    <label class="form-control-label">
                                        Due Date
                                    </label>
                                    <div class="input-group input-group-merge has-label">
                                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-calendar"></i></span></div>
                                        <input type="date" name="dueDate" id="dueDate" class="form-control" required />
                                    </div>
                                    <!---->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row document-item-body">
                        <div class="col-sm-12 p-0" style="table-layout: fixed;">

                            <div class="table-responsive mt-4">
                                <table class="table table-stripped table-center table-hover" id="itemsTable">
                                    <thead>
                                        <tr>
                                            <th scope="col" style="width:99px">ID</th>
                                            <th scope="col">Item</th>
                                            <th scope="col">Category</th>
                                            <th scope="col" style="width: 500px">Description</th>
                                            <th scope="col">Quantity</th>
                                            <th scope="col">Price</th>
                                            <th scope="col">
                                                <div style="">
                                                    <a id="add_field" onclick="setTimeout(priceUpdater, 200)"><i class="fas fa-plus-circle"></i> </a>
                                                    <a id="remove_field" onclick="setTimeout(priceUpdater, 200)"><i class="fas fa-minus-circle"></i> </a>
                                                </div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="input_fields_wrap">
                                        <tr id="itemRow">
                                            <td scope="row">
                                                <input type="text" class="form-control" disabled="" id="id1">

                                            </td>
                                            <td scope="row">
                                                <div class="form-group">

                                                    @Html.DropDownList("itemID1", ViewBag.items as SelectList, new { @class = "form-control ", @style = "margin-top: 15px", onchange = "updater(1)" })


                                                </div>
                                            </td>
                                            <td scope="row">
                                                <input type="text" class="form-control" disabled id="category1">

                                            </td>
                                            <td scope="row">
                                                <input type="text" class="form-control" disabled id="description1">

                                            </td>
                                            <td scope="row">
                                                <input type="number" class="form-control" min="1" name="qt1" id="qt1" onchange="priceUpdater()" onclick="priceUpdater()">
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" disabled="" id="price1">
                                            </td>

                                            <td class="add-remove" scope="row">
                                            </td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row document-item-body">
                        <div class="col-sm-12 mb-4 p-0">
                            <div class="table-responsive overflow-x-scroll overflow-y-hidden">
                                <table id="totals" class="table">
                                    <colgroup>
                                        <col class="document-total-50">
                                        <col class="document-total-30">
                                        <col class="document-total-25">
                                        <col class="document-total-40-px">
                                    </colgroup>
                                    <tbody id="invoice-total-rows" class="table-padding-05">
                                        <tr id="tr-subtotal">
                                            <td class="border-bottom-0 pb-0"></td>
                                            <td class="text-right border-right-0 border-bottom-0 align-middle pb-0 pr-0"><strong>Subtotal </strong></td>
                                            <td class="text-right border-bottom-0 long-texts pb-0 pr-3">
                                                <div>
                                                    <div class="disabled text-right disabled-money">
                                                        <input type="tel" class="v-money form-control text-right disabled-money" name="subtotal" id="subtotal" placeholder="00.00" disabled="disabled">

                                                    </div>
                                                </div>
                                            </td>
                                            <td class="border-bottom-0 pb-0" style="max-width: 40px;"></td>
                                        </tr>
                                        <tr id="tr-discount">
                                            <td class="border-top-0 pt-0 pb-0"></td>
                                            <td class="text-right border-top-0 border-right-0 border-bottom-0 align-middle pt-0 pb-0 pr-0">
                                                <div>

                                                    <div class="el-popover__reference-wrapper" id="addDiscountSection">
                                                        <a class="cursor-pointer text-info el-link el-link--primary is-underline el-popover__reference" data-toggle="modal" data-target="#add_discount" tabindex="0">
                                                            <span class="el-link--inner">Add Discount</span>
                                                        </a>
                                                    </div>

                                                    <div class="el-popover__reference-wrapper" id="editDiscountSection">
                                                        <div class="row" style="margin-left:260px">

                                                            <div class="col-md-4">
                                                                <a class="cursor-pointer text-info el-link el-link--primary is-underline el-popover__reference" data-toggle="modal" data-target="#add_discount" tabindex="0">
                                                                    <span class="el-link--inner">Edit </span>
                                                                </a>
                                                            </div> ·
                                                            <div class="col-md-4">
                                                                <a class="cursor-pointer text-info el-link el-link--primary is-underline el-popover__reference" id="removeDiscount" tabindex="0" onclick="setTimeout(priceUpdater,200)">
                                                                    <span class="el-link--inner">Remove Discount</span>
                                                                </a>
                                                            </div>

                                                        </div>
                                                    </div>

                                                </div>
                                            </td>

                                            <td class="text-right border-top-0  border-bottom-0 pt-0 pb-0 pr-3">
                                                <div>
                                                    <div class="disabled text-right disabled-money">
                                                        <input type="tel" class="v-money form-control text-right disabled-money" name="discount" id="discount" placeholder="" disabled="disabled"> <!---->
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="border-top-0 pt-0 pb-0" style="max-width: 40px;"></td>
                                        </tr>


                                        <tr id="tr-tax">
                                            <td class="border-top-0 pt-0 pb-0"></td>
                                            <td class="text-right border-top-0 border-right-0 border-bottom-0 align-middle pt-0 pb-0 pr-0">
                                                <div>

                                                    <div class="el-popover__reference-wrapper" id="addTaxSection">
                                                        <a class="cursor-pointer text-info el-link el-link--primary is-underline el-popover__reference" data-toggle="modal" data-target="#add_tax" tabindex="0">
                                                            <span class="el-link--inner">Add Tax</span>
                                                        </a>
                                                    </div>

                                                    <div class="el-popover__reference-wrapper" id="editTaxSection">
                                                        <div class="row" style="margin-left:260px">

                                                            <div class="col-md-4">
                                                                <a class="cursor-pointer text-info el-link el-link--primary is-underline el-popover__reference" data-toggle="modal" data-target="#add_dax" tabindex="0">
                                                                    <span class="el-link--inner">Edit </span>
                                                                </a>
                                                            </div> ·
                                                            <div class="col-md-4">
                                                                <a class="cursor-pointer text-info el-link el-link--primary is-underline el-popover__reference" id="removeDiscount" tabindex="0" onclick="setTimeout(priceUpdater,200)">
                                                                    <span class="el-link--inner">Remove Tax</span>
                                                                </a>
                                                            </div>

                                                        </div>
                                                    </div>

                                                </div>
                                            </td>
                                            <td class="text-right border-top-0  border-bottom-0 pt-0 pb-0 pr-3">
                                                <div>
                                                    <div class="disabled text-right disabled-money">
                                                        <input type="tel" class="v-money form-control text-right disabled-money" name="tax" id="tax" placeholder="" disabled="disabled">
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="border-top-0 pt-0 pb-0" style="max-width: 40px;"></td>
                                        </tr>

                                        <tr id="tr-total">
                                            <td class="border-top-0 pt-0 pb-0"></td>
                                            <td class="text-right border-top-0 border-right-0 align-middle pt-0 pb-0 pr-0">
                                                <strong class="document-total-span">Total</strong>
                                            </td>
                                            <td class="text-right border-top-0 long-texts pt-0 pb-0 pr-3">
                                                <div>
                                                    <div class="disabled text-right disabled-money">
                                                        <input type="text" class="v-money form-control text-right disabled-money" name="total" id="total" placeholder="00.00 MKD" disabled="disabled"> <!---->
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="border-top-0 pt-0 pb-0" style="max-width: 40px;"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <br />
                    <div class="row embed-card-body-footer">


                        <div class="form-group col-md-8 embed-acoordion-textarea">
                            <label for="notes" class="form-control-label">Notes</label>
                            <textarea name="notes" placeholder="Enter Notes" rows="3" cols="50" id="notes" class="form-control embed-card-body-footer-textarea"></textarea>
                        </div>

                        <div class="col-md-4">
                            <div class="text-right mt-4 mr-3">
                                <button type="submit" class="btn btn-primary">Add Invoice</button>
                            </div>
                        </div>





                    </div>
                </div>


                <!-- Add vendor Modal -->
                <div id="add_customer" class="modal custom-modal fade" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Customer</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <h5 align="center">Please choose a Customer for your Invoice.</h5>
                                <div class="form-group">
                                    @Html.DropDownList("customersList", ViewBag.customers as SelectList, new { @class = "form-control ", @style = "margin-top: 15px" })

                                </div>


                                <div class="submit-section">
                                    <button id="addSelectedCustomer" class="btn btn-primary submit-btn" data-dismiss="modal">Select Customer</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Add customer Modal -->
                <!-- Add discount Modal -->
                <div id="add_discount" class="modal custom-modal fade" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Discount</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <h5 align="center">Add discount for this invoice (in percentage).</h5>
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <input type="number" min="1" max="100" class="form-control" aria-label="" name="discountValue" id="discountValue">
                                        <div class="input-group-append">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                </div>


                                <div class="submit-section">
                                    <button id="addDiscountButton" class="btn btn-primary submit-btn" data-dismiss="modal" onclick="setTimeout(priceUpdater, 200)">Add Discount</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Add discount Modal -->

                <!-- Add tax Modal -->
                <div id="add_tax" class="modal custom-modal fade" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Tax</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                                <h5 align="center">Select a tax for this invoice.</h5>
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        @Html.DropDownList("taxID", ViewBag.taxes as SelectList, new { @class = "form-control ", @style = "" })

                                    </div>
                                </div>


                                <div class="submit-section">
                                    <button id="addTaxButton" class="btn btn-primary submit-btn" data-dismiss="modal" onclick="setTimeout(priceUpdater, 200)">Add Tax</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Add tax Modal -->
            }
        </div>
    </div>
</div>

<!-- Add expense Modal -->
<div id="add_sale" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add expense category</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("addcategory", "sales", new
                {
                    from = "invoices"
                }, FormMethod.Post))
                {


                    <div class="form-group">
                        <label>Name<span class="text-danger">*</span></label>
                        <input class="form-control" type="text" name="saleName" required autocomplete="off">
                    </div>

                    <div class="form-group">
                        <label>Description<span class="text-danger"></span></label>
                        <input class="form-control" type="text" name="saleDescription" autocomplete="off" required>
                    </div>
                    <div class="submit-section">
                        <input type="submit" class="btn btn-primary submit-btn" value="Create Sale Category" />
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<!-- /Add expense Modal -->


<script>
    window.onload = function () {
        priceUpdater();
    };




    $(document).ready(function () {

        $("#taxID").prepend("<option value='0' selected='selected'>Choose tax</option>");


     

            var max_fields = 50; //maximum input boxes allowed
            var wrapper = $("#input_fields_wrap"); //Fields wrapper
            var add_button = $("#add_field");
            $("#remove_field").hide();
            $("#editDiscountSection").hide();
            $("#editTaxSection").hide();

            $("#customerDetails").hide();




            x = 1;
            $("#add_field").click(function (e) { //on add input button click
                e.preventDefault();
            if (x < max_fields) { //max input box allowed
                x++; //text box increment

                $(wrapper).append('<tr id="itemRow' + x + '" class="row-added"><td scope="row"><input type="text" class="form-control" id="id' + x + '" disabled /></td> <td scope="row"><div class="form-group"><select onchange="updater(' + x + ')" class = "form-control mt-3"  id="itemID' + x + '" name="itemID' + x + '"></select></div> </td> <td scope="row"><input type="text" class="form-control" id="category' + x + '" disabled /></td> <td scope="row"><input type="text" class="form-control" id="description' + x + '" disabled /></td> <td scope="row"><input type="number" min="1" class="form-control" name="qt' + x + '" id="qt' + x + '"  onchange="priceUpdater()"/></td> <td scope="row"><input type="text" class="form-control" id="price' + x + '" disabled /></td>');
                var items = document.getElementById('itemID1');
                var itemsHTML = items.innerHTML;
                var clonedItems = document.getElementById('itemID' + x);
                clonedItems.innerHTML = itemsHTML;
                updater(x);



                if (x > 1) {
                    $("#remove_field").show();


                }
                else {
                    $("#remove_field").hide();

                }

            $.ajax({
            type: "Get",
            url: '@Url.Action("GetItemDetails", "Sales")',
             data: { id: $("#itemID" + x).val() },
            dataType: "json",
              success: function (data) {
                  $("#id" + x).val(data[0]);
                  $("#price" + x).val(parseFloat(data[1]));
                  $("#description" + x).val(data[2]);
                  $("#category" + x).val(data[3]);
            }
            });


                $("#itemCounter").val(x);


            }

        });



           $.ajax({
            type: "Get",
            url: '@Url.Action("GetItemDetails", "Sales")',
             data: { id: $("#itemID1").val() },
            dataType: "json",
              success: function (data) {

                  $("#id1").val(data[0]);
                  $("#price" + x).val(parseFloat(data[1]));
                  $("#description1").val(data[2]);
                  $("#category1").val(data[3]);
                  if ($("#qt1" ).val().length === 0) {
                      $("#qt1").val(1);
                  }
            }
            });






        $("#addSelectedCustomer").click(function (e) {
          
            $("#addCustomer").hide();
            $.ajax({
            type: "Get",
            url: '@Url.Action("GetCustomerDetails", "Sales")',
             data: { id: $("#customersList").val() },
            dataType: "json",
              success: function (data) {
                  $("#customerName").text(data[0]);
                  $("#customerTaxNo").text(data[1]);
                  $("#customerAddress").text(data[2]);
                  $("#customerPhone").text(data[3]);
                  $("#customerEmail").text(data[4]);
                  $("#customerDetails").show();
            }
            });
        });



        $("#addDiscountButton").click(function (e) {

            if (parseInt($("#discountValue").val()) < 1 || parseInt($("#discountValue").val()) > 100) {
                alert("Discount interval should be between 1 and 100 %.");
            }
            else {
                $("#discount").val(parseInt($("#discountValue").val()));
                $("#editDiscountSection").show();
                $("#addDiscountSection").hide();
            }

        });


        $("#removeDiscount").click(function (e) {

            $("#discount").val(null);
            $("#editDiscountSection").hide();
            $("#addDiscountSection").show();
        });


        $("#addTaxButton").click(function (e) {
             $.ajax({
            type: "Get",
            url: '@Url.Action("GetTaxDetails", "Sales")',
            data: { id: $("#taxID").val() },
            dataType: "json",
              success: function (data) {
                  $("#tax").val(parseInt(data[0]));
            }
            });


                $("#editTaxSection").show();
                $("#addTaxSection").hide();


        });

        $("#removeTax").click(function (e) {

            $("#tax").val(null);
            $("#editTaxSection").hide();
            $("#addTaxSection").show();
        });


        $("#remove_field").click(function (e) { //user click on remove text
            e.preventDefault();
            $("#itemRow" + x).remove();
            if (x > 1) {

                x--;
                updater(x);
                if (x > 1) {
                    $("#remove_field").show();


                }
                else {
                    $("#remove_field").hide();

                }
            }
        })

    });

    function updater(x) {
            $.ajax({
            type: "Get",
            url: '@Url.Action("GetItemDetails", "Sales")',
             data: { id: $("#itemID" + x).val() },
            dataType: "json",
              success: function (data) {
                  $("#id" + x).val(data[0]);
                  $("#price" + x).val(parseFloat(data[1]));
                  $("#description" + x).val(data[2]);
                  $("#category" + x).val(data[3]);

                  if ($("#qt" + x).val().length === 0)
                  {
                      $("#qt" + x).val(1);
                  }
                  priceUpdater();

            }
            });


    }
 
    function priceUpdater() {

        var k = $('#itemsTable tr').length;
        var s = 0;

        for (i = 1; i <= k - 1; i++) {
            s += parseFloat($("#price" + i).val()) * parseInt($("#qt" + i).val());

        }

        if ($("#discount").val().length === 0 && $("#tax").val().length === 0) { // if there's no discount and tax
            $("#subtotal").val(addCommas(s.toFixed(2)) + " MKD");

            $("#total").val(addCommas(s.toFixed(2)) + " MKD");

            $("#totalAmount").val(parseFloat(s.toFixed(2)));
        }
        else if ($("#discount").val().length != 0 && $("#tax").val().length === 0) // if there's discount but no tax
        {
            var discount = $("#discount").val();

            $("#subtotal").val(addCommas(s.toFixed(2)) + " MKD");
            var subtotalSeperator = $("#subtotal").val();
            subtotalSeperator = subtotalSeperator.slice(0, -3);
            subtotalSeperator.replace(/\,/g, '');
            stotal = subtotalSeperator.replace(/\,/g, '');
            var finalprice = parseInt(s.toFixed(2)) - (parseInt(s.toFixed(2)) * ((parseInt(discount) / 100)));
            var total = Math.round(finalprice);
            $("#total").val(addCommas(total) + " MKD");
        }
        else if ($("#discount").val().length === 0 && $("#tax").val().length != 0) // if there's tax but no discount
        {
            var tax = $("#tax").val();
            $("#subtotal").val(addCommas(s.toFixed(2)) + " MKD");

            var total = calculateTax(parseInt(s), tax);
            $("#total").val(addCommas(total) + " MKD");
        }
        else {                                                                       // if there's discount and tax

            var discount = $("#discount").val();
            var tax = $("#tax").val();
            $("#subtotal").val(addCommas(s.toFixed(2)) + " MKD");
            var subtotalSeperator = $("#subtotal").val();
            subtotalSeperator = subtotalSeperator.slice(0, -3);
            subtotalSeperator.replace(/\,/g, '');
            stotal = subtotalSeperator.replace(/\,/g, '');

            var finalprice = parseInt(s) - (parseInt(s) * ((parseInt(discount) / 100)));
            var total = Math.round(finalprice);
            var totalAfterTax = calculateTax(total,tax);
            $("#total").val(addCommas(totalAfterTax) + " MKD");
        }



    }


    function addCommas(nStr) {
        nStr += '';
        var x = nStr.split('.');
        var x1 = x[0];
        var x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }

        return x1 + x2;
    }

    function calculateTax (amount, taxPercent) {
        // Whatever math is involved to calculate your sales tax here
        var tax = parseFloat(taxPercent / 100).toFixed(2);
        console.log(amount + (amount * tax));
        return amount + (amount * tax);

    }





</script>